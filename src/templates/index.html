<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_title }} - Red Bull Racing</title>
    <link rel="icon" type="image/png" href="/static/images/favicon.png">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <img src="/static/images/logo.png" alt="Red Bull x OpenShift" class="header-logo">
                    <div class="header-text">
                        <h1>{{ app_title }}</h1>
                        <p class="subtitle">Navigate your OpenShift clusters organized by site</p>
                        <div class="sync-info">
                            <div class="sync-indicator" id="syncIndicator" style="display: none;">
                                <span class="sync-dot"></span>
                                Syncing with VLAN Manager...
                            </div>
                            <div class="last-sync-time" id="lastSyncTimeDisplay">
                                <span class="sync-label">Last sync:</span>
                                <span class="sync-value" id="lastSyncTimeValue">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-controls">
                    <button id="darkModeToggle" class="btn-icon" onclick="toggleDarkMode()" title="Toggle Dark Mode (Ctrl+D)">
                        <svg id="darkModeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <button id="adminToggle" class="btn-icon" onclick="toggleAdminPanel()" title="Admin Panel">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- Admin Login Panel -->
            <section id="adminLoginPanel" class="admin-login-panel" style="display: none;">
                <h2>Admin Login</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminUsername">Username</label>
                        <input type="text" id="adminUsername" name="username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" name="password" required autocomplete="current-password">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Login</button>
                        <button type="button" class="btn-secondary" onclick="toggleAdminPanel()">Cancel</button>
                    </div>
                </form>
                <div id="loginMessage" class="message"></div>
            </section>

            <!-- Admin Control Panel (Hidden by default, shown after login) -->
            <section id="adminControlPanel" class="admin-control-panel" style="display: none;">
                <div class="section-header">
                    <h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        Admin Control Panel
                    </h2>
                    <button class="btn-logout" onclick="logout()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                </div>
                <div class="admin-actions">
                    <button class="btn-primary" onclick="hardRefresh()" id="hardRefreshBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                        Hard Refresh from VLAN Manager
                    </button>
                    <button class="btn-secondary" onclick="toggleCreateClusterForm()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create Cluster
                    </button>
                    <button class="btn-secondary" onclick="exportClusters()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export JSON
                    </button>
                    <div id="refreshStatus" class="message"></div>
                </div>

                <!-- Create Cluster Form -->
                <div id="createClusterForm" class="create-cluster-form" style="display: none;">
                    <h3>Create New Cluster</h3>
                    <form id="clusterForm" onsubmit="createCluster(event)">
                        <div class="form-group">
                            <label for="newClusterName">Cluster Name *</label>
                            <input type="text" id="newClusterName" name="clusterName"
                                   placeholder="ocp4-example"
                                   pattern="^ocp4-[a-z0-9][a-z0-9\-]*[a-z0-9]$"
                                   title="Must start with 'ocp4-', lowercase alphanumeric with hyphens"
                                   required>
                            <small>Must start with 'ocp4-', lowercase alphanumeric with hyphens</small>
                        </div>
                        <div class="form-group">
                            <label for="newClusterSite">Site *</label>
                            <select id="newClusterSite" name="site" required>
                                <option value="">Select a site...</option>
                            </select>
                            <small>Sites from VLAN Manager</small>
                        </div>
                        <div class="form-group">
                            <label for="newClusterSegments">Network Segments (CIDR) *</label>
                            <textarea id="newClusterSegments" name="segments"
                                      placeholder="192.168.1.0/24&#10;192.168.2.0/24"
                                      rows="3"
                                      required></textarea>
                            <small>One CIDR per line (e.g., 192.168.1.0/24)</small>
                        </div>
                        <div class="form-group">
                            <label for="newClusterDomain">Domain Name</label>
                            <input type="text" id="newClusterDomain" name="domainName"
                                   placeholder="example.com"
                                   value="example.com">
                        </div>
                        <div class="form-group">
                            <label for="newClusterLoadBalancerIP">LoadBalancer IP Address (Optional)</label>
                            <input type="text" id="newClusterLoadBalancerIP" name="loadBalancerIP"
                                   placeholder="192.168.100.10"
                                   pattern="^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$"
                                   title="Must be a valid IPv4 address">
                            <small>Optional - will be auto-resolved via DNS if not provided</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Create Cluster</button>
                            <button type="button" class="btn-secondary" onclick="toggleCreateClusterForm()">Cancel</button>
                        </div>
                    </form>
                    <div id="createClusterMessage" class="message"></div>
                </div>
                <div class="admin-info">
                    <p><strong>Data Source:</strong> VLAN Manager API (Auto-sync every 5 minutes)</p>
                    <p><strong>Last Sync:</strong> <span id="lastSyncTime">Loading...</span></p>
                    <p id="syncStats"></p>
                </div>
            </section>

            <!-- Statistics Dashboard -->
            <section id="statisticsDashboard" class="statistics-dashboard" style="display: none;">
                <div class="section-header">
                    <h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Statistics Dashboard
                    </h2>
                    <button class="btn-secondary" onclick="toggleDashboard()">Close</button>
                </div>
                
                <div class="dashboard-content">
                    <div class="stats-overview">
                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-value" id="statTotalClusters">0</div>
                            <div class="stat-label">Total Clusters</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üåê</div>
                            <div class="stat-value" id="statTotalSites">0</div>
                            <div class="stat-label">Total Sites</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üîó</div>
                            <div class="stat-value" id="statTotalSegments">0</div>
                            <div class="stat-label">Total Segments</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value" id="statAvgSegments">0</div>
                            <div class="stat-label">Avg Segments/Cluster</div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Clusters per Site</h3>
                            <canvas id="clustersPerSiteChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Source Distribution</h3>
                            <canvas id="sourceDistributionChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Domain Distribution</h3>
                            <canvas id="domainDistributionChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Segments per Site</h3>
                            <canvas id="segmentsPerSiteChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Clusters Display -->
            <section class="clusters-section">
                <div class="section-header">
                    <h2>Clusters</h2>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="toggleDashboard()" title="Statistics Dashboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            Dashboard
                        </button>
                        <button class="btn-secondary" onclick="exportData('csv')" title="Export as CSV">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            CSV
                        </button>
                        <button class="btn-secondary" onclick="exportData('excel')" title="Export as Excel">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Excel
                        </button>
                        <button class="btn-refresh" onclick="loadClusters()" title="Refresh Data (Ctrl+R)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="filter-controls">
                    <div class="search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search clusters by name, site, or segment... (Ctrl+K)" onkeyup="filterClusters()">
                        <button class="clear-search" id="clearSearch" onclick="clearSearch()" style="display: none;" title="Clear search">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>

                    <div class="filter-dropdowns">
                        <select id="siteFilter" onchange="filterClusters()">
                            <option value="">All Sites</option>
                        </select>

                        <select id="viewMode" onchange="changeViewMode()">
                            <option value="grouped">Grouped by Site</option>
                            <option value="list">List View</option>
                            <option value="compact">Compact Grid</option>
                        </select>
                    </div>

                    <div class="cluster-stats">
                        <span id="clusterCount" class="stat-badge">0 clusters</span>
                        <span id="siteCount" class="stat-badge">0 sites</span>
                    </div>
                </div>

                <!-- Active Filters -->
                <div id="activeFilters" class="active-filters" style="display: none;"></div>

                <div id="loadingSpinner" class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading clusters...</p>
                </div>

                <div id="clustersContainer"></div>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin-bottom: 16px; opacity: 0.5;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <p>No clusters found. Clusters are automatically synced from VLAN Manager.</p>
                </div>
            </section>
        </main>

        <footer>
            <p>
                <strong>Red Bull Racing √ó OpenShift</strong> - Cluster Navigator v1.0.0
                <br>
                Data synced from VLAN Manager
                <br>
                <small>Keyboard shortcuts: Ctrl+K (Search), Ctrl+D (Dark Mode), Ctrl+R (Refresh)</small>
            </p>
        </footer>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip" style="display: none;"></div>

    <script src="/static/js/vendor/chart.umd.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/enhanced.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
